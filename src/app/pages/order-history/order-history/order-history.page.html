<ion-header>
  <ion-toolbar>

    <ion-buttons class="rounded-circle" slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>

    <ion-title>
      Order History
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <div>
    <!-- <h3>Sort:</h3> -->
    
    <ion-row>

      <ion-col size="6">
        <ion-item>
          <ion-select interface="action-sheet" placeholder="Select Date">
            <ion-select-option value="Today">Today</ion-select-option>
            <ion-select-option value="Last Week">Last Week</ion-select-option>
            <ion-select-option value="This Week">This Week</ion-select-option>
            <ion-select-option value="This Month">This Month</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-col>

      <ion-col size="6">
        <ion-item>
          <ion-select interface="action-sheet" placeholder="Select status">
            <ion-select-option value="In Transit">In Transit</ion-select-option>
            <ion-select-option value="Completed">Completed</ion-select-option>
            <ion-select-option value="Pending">Pending</ion-select-option>
            <ion-select-option value="Delivered">Delivered</ion-select-option>
            <ion-select-option value="Cancelled">Cancelled</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-col>

      <ion-col size="12">
        <button class="btn btn-dark d-block mx-auto d-flex align-items-center justify-content-center"> <ion-icon class="me-1" name="filter-outline"></ion-icon> Sort</button>
      </ion-col>

    </ion-row>
  </div>

  <ion-item class="ion-text-center" *ngIf="!orders">
    <ion-label>
      No Products Ordered
    </ion-label>
  </ion-item>

  <div class="border mt-3" *ngFor="let order of orders">

    <ion-item lines="none">
      <ion-thumbnail slot="start">
        <img alt="Silhouette of mountains" [src]="order.product.image.url" />
      </ion-thumbnail>
      <ion-label>
        <h2>Order #{{ order.id }}</h2>
        <p>Date: {{ order.createdAt | date:'MMM d, y h:mm a' }}</p>
        <p>Total: {{ order.price | currency }}</p>
        <p>Status: <b [class.text-success]="order.status=='Completed'" [class.text-warning]="order.status=='Pending'" [class.text-primary]="order.status=='In Transit'" [class.text-info]="order.status=='Delivered'" [class.text-danger]="order.status=='Cancelled'" > {{ order.status }} </b> </p>
      </ion-label>
      <ion-button style="--background:black;" slot="end" (click)="toggleOrderDetails(order.id)">
        <ion-icon name="chevron-down-outline" *ngIf="showDetails!=order.id"></ion-icon>
        <ion-icon name="chevron-up-outline" *ngIf="showDetails==order.id"></ion-icon>
      </ion-button>
    </ion-item>

    <div class="animate__animated animate__fadeInDown" *ngIf="showDetails==order.id">

    <ion-item>
      <ion-label>
        <ion-row class="ion-text-center">
          <ion-col class="ion-text-start" size="9"><h3>Item</h3></ion-col>
          <ion-col size="3"><h3>Quantity</h3></ion-col>

          <ion-col class="ion-text-start" size="9">
            <p class="text-wrap">{{order.product.name}}</p>
          </ion-col>

          <ion-col size="3">
            <p>{{order.quantity}}</p>
          </ion-col>

        </ion-row>
          
      </ion-label>
    </ion-item>

    <ion-item>
      <ion-label>
        <h3>Payment Method: {{order.Payments[0].paymentMethod=="Cash" ? "Cash On Delivery" : "Mobile Money" }} </h3>
        <p *ngIf="order.Payments[0].transactionId!='N/A'"> Status: {{order.Payments[0].transactionId!="N/A" ? "Paid" : "" }} </p>
      </ion-label>
    </ion-item>

      <h3 class="ms-2 mb-0"> Seller Info: </h3>

    <ion-item button>
      <ion-avatar slot="start">
        <img alt="Silhouette of a person's head" [src]="order.seller.user_profile.url" />
      </ion-avatar>
      <ion-label>
        <h3>{{order.seller.username}}</h3>
        <p>{{order.seller.phone_number}}</p>
        <p>{{order.seller.email}}</p>
        <button class="btn btn-dark d-flex align-items-center justify-content-center mt-2">
          <ion-icon class="me-2" name="chatbubbles"></ion-icon> Chat Seller</button>
      </ion-label>
    </ion-item>

    </div>

    <button *ngIf="order.status == 'Delivered'" class="btn btn-success my-3 d-block mx-auto d-flex align-items-center justify-content-center">
      <ion-icon class="me-1" name="shield-checkmark"></ion-icon> Confirm Product Receipt
    </button>
    
  </div>

</ion-content>
